<!DOCTYPE html>

<html>

	<head>
		<title> Track generator </title>
	</head>

	<body>

		Track Generator<br><br>

		X: <input type="number" id="sizex"></input>
		Y: <input type="number" id="sizey"></input>
		<button onclick="startdraw();"> Go! </button>

		<br><br><div id="container" style="display:none;">
			<canvas id="can" style="border:1px solid black;"> </canvas>
			<button onclick="download();"> Done! </button>
		</div>

		<script>

			let sizex, sizey, can, ctx, canx, cany, prevclick, container;
			let out;
			window.onload = () => {
			
				sizex = document.getElementById("sizex");
				sizey = document.getElementById("sizey");
				sizex.value = 400;
				sizey.value = 400;
				
				can = document.getElementById("can");
				container = document.getElementById("container");

				ctx = can.getContext("2d");
				
			}

			function startdraw() {

				canx = sizex.value;
				cany = sizey.value;
				
				ctx.canvas.width  = canx;
				ctx.canvas.height = cany;

				ctx.strokeStyle = "white";
				ctx.lineWidth = 20;
				ctx.lineCap = "round";
				ctx.fillStyle = "black";

				ctx.fillRect(0, 0, canx, cany);
				
				container.style.display = "block";

				can.onclick = click;

				prevclick = undefined;
				out = [];
				
			}

			function click(e) {
				let rect = can.getBoundingClientRect();
				let x = e.clientX - rect.left;
				let y = e.clientY - rect.top;
				console.log(x, y);

				ctx.beginPath();
				ctx.moveTo(x, y);
				if (prevclick == undefined) {
					//out.innerHTML = `Size:<br>(${canx}, ${cany})<br>Data: `
					ctx.lineTo(x, y + 1);		 
				} else {
					ctx.lineTo(prevclick[0], prevclick[1]);
				}
				ctx.stroke();
				
				prevclick = [x, y];	
				//out.innerHTML += `<br>(${x}, ${y})`;
				out.push(x);
				out.push(y);
				
			}

			let data;
			function download() {
				data = new Int16Array(3 + out.length);
				data[0] = canx;
				data[1] = cany;
				data[2] = out.length / 2;
				for (let i = 0; i < out.length; i += 2) {
					data[i + 3] = out[i];
					data[i + 4] = out[i + 1];
				}  
				//return;
				data = new Blob([new Uint8Array(data.buffer)]);
				
				download = document.createElement("a");
				download.download = "map.map";
				download.rel = 'noopener';
				download.href = window.URL.createObjectURL(data);
				download.click();
				delete download;
				
				console.log(data);
			}

		</script>

	</body>

</html>
